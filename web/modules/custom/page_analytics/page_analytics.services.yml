services:
  page_analytics.report_controller:
    class: Drupal\page_analytics\Controller\PageAnalyticsReportController
    arguments:
      - "@database"
      - "@datetime.time"

  page_analytics.path_exclusion:
    class: Drupal\page_analytics\PathExclusion\PageAnalyticsExclusion
    arguments:
      - "@config.factory"
      - "@path.matcher"
      - "@router.route_provider"
      - "@router.admin_context"

  # Before page cache (priority 210 > 200) so cache hits are counted too.
  http_middleware.page_analytics:
    class: Drupal\page_analytics\StackMiddleware\PageAnalyticsMiddleware
    arguments:
      - "@config.factory"
      - "@queue"
      - "@datetime.time"
      - "@current_user"
      - "@page_analytics.path_exclusion"
    tags:
      - { name: http_middleware, priority: 210 }
