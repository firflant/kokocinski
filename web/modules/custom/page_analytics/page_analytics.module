<?php

/**
 * @file
 * Page Analytics module.
 */

declare(strict_types=1);

/**
 * Implements hook_theme().
 */
function page_analytics_theme(array $existing, string $type, string $theme, string $path): array {
  return [
    'page_analytics_report' => [
      'variables' => [
        'rows' => [],
        'period' => 7,
        'period_7_url' => '',
        'period_30_url' => '',
        'sampling_rate' => 1,
        'sampling_note' => '',
      ],
      'template' => 'page-analytics-report',
    ],
  ];
}

/**
 * Implements hook_cron().
 */
function page_analytics_cron(): void {
  $retention_days = (int) \Drupal::config('page_analytics.settings')->get('retention_days');
  if ($retention_days < 1) {
    $retention_days = 365;
  }
  $cutoff = date('Y-m-d', strtotime("-{$retention_days} days"));
  \Drupal::database()->delete('page_analytics_daily')
    ->condition('stat_date', $cutoff, '<')
    ->execute();
}
